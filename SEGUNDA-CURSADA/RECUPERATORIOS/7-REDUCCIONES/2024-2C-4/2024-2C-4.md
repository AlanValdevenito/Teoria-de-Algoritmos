# Enunciado 

Grace, docente de un primer grado de un colegio primario, tiene como tarea armar la fila del acto del 9 de julio. Como no quiere que los chicos se distraigan, quiere que cada alumno quede entre dos personas de las cuales no es amigo. 

El problema de la fila del primario (en versión de problema de decisión) puede formularse como: “Dado un listado de alumnos, y un diccionario que indica qué alumnos son amigos de cuál, ¿existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos?”.

Demostrar que El problema de la fila del primario es un problema NP-Completo. 

Para esto, recomendamos recordar que el problema de Camino Hamiltoniano es un problema NP-Completo. También, recomendamos recordar cómo fue que demostramos en clase que K-Clique es un problema NP-Completo (con la ayuda de Independent Set).

El problema de Camino Hamiltoniano es el siguiente: Dado un grafo, ¿existe un camino que visite cada vertice de G exactamente una vez?.

# Demostracion

Notacion:
- Fila del primario: FP
- Camino Hamiltoniano: CH

Para demostrar que el problema de FP es un problema NP-Completo debemos:
- Demostrar que el problema se encuentra en NP
- Reducir el problema de CH al problema de FP: CH $\leq_P$ FP

Nota: Para la segunda demostracion es importante demostrar que nuestra reduccion es correcta demostrando la doble implicacion.

La segunda demostracion nos indica que el problema de FP es al menos tan dificil de resolver como el problema de CM. Esto significa que resolver el problema de CH puede ser transformado en resolver el problema de FP.

## Demostracion I: El problema se encuentra en NP

Para que el problema se encuentre en NP, debe haber un verificador eficiente.

En otras palabras, debe haber un verificador que ejecute en tiempo polinomial.

Verificador: Recibe una instancia del problema y una solucion.

```py
def verificador(alumnos, amigos, fila):
    alumnos = set(alumnos)

    # Validamos que la cantidad de alumnos en la fila sea igual a la cantidad total de alumnos
    if len(alumnos) != len(fila): return False

    # Validamos que los alumnos en la fila sean realmente alumnos
    for alumno in fila:
        if alumno not in alumnos: return False

    amigos = {alumno: set(a) for alumno, a in amigos.items()}

    # Validamos que no haya ningún par de amigos consecutivos
    for i in range(1, len(fila)):
        a1 = fila[i-1]
        a2 = fila[i]

        if a1 in amigos[a2]: return False

    return True
```

Complejidad: La complejidad resulta ser O(n) con n la cantidad de alumnos
- Convertir la lista de alumnos un conjunto (set) tiene una complejidad de O(n) con n la cantidad de alumnos
- Validar que la cantidad de alumnos en la fila sea igual a la cantidad total de alumnos tiene una complejidad de O(1)
- Validar que los alumnos en la fila sean realmente alumnos tiene una complejidad de O(n) con n la cantidad de alumnos
- Validar que no haya ningún par de amigos consecutivos tiene una complejidad de O(n) con n la cantidad de alumnos

Luego, se ejecuta en tiempo polinomial, lo cual quiere decir que el problema se encuentra en NP.

## Demostracion II: Reduccion de un problema NP-Completo

Debemos demostrar que CH $\leq_P$ FP.

### Reduccion planteada

¿Podemos resolver el problema de CH utilizando la solucion del problema de FP?.

Vamos a utilizar una caja negra que resuelve el problema de FP para resolver el problema de CH.

El problema de CH recibe un grafo G.

Transformacion del problema: Transformamos la entrada del problema de CH en una entrada del problema FP
- Creamos el grafo complemento $G'$ de $G$.
- Transformamos los vertices $V_i$ del grafo $G'$ en alumnos $A_i$.
- Para cada arista ($V_i$, $V_j$) del grafo complemento $G'$ agregamos al alumno $A_j$ al diccionario de amigos $A_i$. Es decir, las aristas que unen a los vertices en el grafo $G'$ representan qué alumnos son amigos de cuál.

Esta transformacion requiere una cantidad de pasos polinomiales.

Ejemplo de la transformacion propuesta:

![Transformacion](2024-2C-4/transformacion.png)

A continuacion, para demostrar que la reduccion es correcta, debemos demostrar que:

Hay solucion de CH, si y solo si, hay solucion para el problema de FP.

Para demostrar ambas implicaciones tenemos dos opciones:
- Metodo directo, asumiendo para cada una que la hipotesis es cierta.
- Metodo por absurdo.

### Si hay CH, entonces hay FP

Hipotesis: Existe un camino que visita cada vertice de G exactamente una vez
Tesis: Existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos

Dada nuestra hipotesis, existe un camino Hamiltoniano en el grafo $G$.

Teniendo en cuenta nuestra transformacion, las aristas que unen a los vertices en el grafo $G'$ representan qué alumnos son amigos de cuál. Luego, las aristas que unen a los vertices en el grafo $G$ representan que alumnos NO son amigos de cual.

Dado que los vertices son alumnos y dos vertices unidos por una arista representa que no son amigos, como existe un camino Hamiltoniano entonces existe un camino de tal forma que dos vertices (alumnos) consecutivos no son amigos entre si.

Es decir, el camino Hamiltoniano se corresponde con la fila de alumnos.

Basicamente un camino Hamiltoniano es un ordenamiento de todos los vertices, donde cada par consecutivo tiene arista en el grafo $G$. Luego, por construccion, el grafo $G$ conecta los pares de alumnos que NO son amigos con lo cual el camino es una fila valida.

Por lo tanto, si hay solucion para el problema de CH, entonces hay solucion para el problema de FP.

Nota: No estamos cualquier instancia posible de FP, sino una que resulta de la reduccion planteada.

### Si hay FP, entonces hay CH

Hipotesis: Existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos
Tesis: Existe un camino que visita cada vertice de G exactamente una vez

Dada nuestra hipotesis, consideramos el grafo $G'$ en el cual los vertices son los alumnos y las aristas que unen a los vertices representan que alumnos son amigos de cual.

Teniendo en cuenta nuestra transformacion, las aristas que unen a los vertices en el grafo complemento $G$ representan que alumnos NO son amigos de cual.

En el grafo $G$ tendremos a los alumnos ordenados segùn la fila de tal forma que no haya ningùn par de amigos consecutivos. Esto quiere decir que en el grafo $G$ tendremos un Camino Hamiltoniano que visita a los vertices una unica vez.

Es decir, la fila de alumnos se corresponde con el camino Hamiltoniano.

Por lo tanto, si hay solucion para el problema de FP, entonces hay solucion para el problema de CH.

Nota: No estamos cualquier instancia posible de FP, sino una que resulta de la reduccion planteada.

# Conclusion

Habiendo demostrado que la reduccion es correcta, queda demostrado tambien que el problema de FP es un problema NP-Completo.