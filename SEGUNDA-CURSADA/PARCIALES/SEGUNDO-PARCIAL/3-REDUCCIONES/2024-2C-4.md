# Enunciado

Grace, docente de un primer grado de un colegio primario, tiene como tarea armar la fila del acto del 9 de julio. Como no quiere que los chicos se distraigan, quiere que cada alumno quede entre dos personas de las cuales no es amigo. El problema de la fila del primario (en versión de problema de decisión) puede formularse como: 

“Dado un listado de alumnos, y un diccionario que indica qué alumnos son amigos de cuál, ¿existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos?”.

Demostrar que el problema de la Fila del Primario es un problema NP-Completo. 

Para esto, recomendamos recordar que el problema de Camino Hamiltoniano es un problema NP-Completo. También, recomendamos recordar cómo fue que demostramos en clase que K-Clique es un problema NP-Completo (con la ayuda de Independent Set).

El problema de Camino Hamiltoniano (en version de problema de decision) puede formularse como:

"Dado un grafo no dirigido, ¿existe un camino que recorra todos los vertices del grafo una unica vez?"

# Demostracion

Para demostrar que el problema de la Fila del Primario es un problema NP-Completo debemos:
- Demostrar que el problema se encuentra en NP
- Reducir el problema de CAmino Hamiltoniano al problema de Fila del Primario: Camino Hamiltoniano $\leq_P$ Fila del Primario

Nota: Para la segunda demostracion es importante demostrar que nuestra reduccion es correcta demostrando la doble implicacion.

La segunda demostracion nos indica que el problema de Fila del Primario es al menos tan dificil de resolver como el problema de Camino Hamiltoniano. Esto significa que resolver el problema de Camino Hamiltoniano puede ser transformado en resolver el problema de Fila del Primario.

## Demostracion I: El problema se encuentra en NP

Para que el problema se encuentre en NP, debe haber un verificador eficiente.

En otras palabras, debe haber un verificador que ejecute en tiempo polinomial.

Verificador: Recibe una instancia del problema y una solucion.

```py
def verificador(alumnos, amigos, solucion):
    
    # Validamos que la cantidad de alumnos en la fila sea igual a la cantidad total de alumnos
    if len(alumnos) != len(solucion): return False

    alumnos = set(alumnos)

    # Validamos que todos los alumnos de la solucion sean en efecto alumnos
    for alumno in solucion:
        if alumno not in alumnos: return False
    
    amigos = { alumno: set(amigos) for alumno, amigos in amigos.items() }

    # Validamos que no hay ningun par de amigos consecutivos
    for i in range(1, len(solucion)):
        alumno_izq = solucion[i-1]
        alumno = solucion[i]

        if alumno_izq in amigos[alumno]: return False

    return True
```

Complejidad: El verificador tiene una complejidad de O(n) con n la cantidad de alumnos
- Validar que la cantidad de alumnos en la fial sea igual a la cantidad total de alumnos tiene una complejdad de O(1)
- Validar que todos los alumnos de la solucion sean en efecto alumnos tiene una complejidad de O(n) con n la cantidad de alumnos
- Validar que no hay ningun par de amigos consecutivos tiene una complejidad de O(n) con n la cantidad de alumnos

Luego, se ejecuta en tiempo polinomial, lo cual quiere decir que el problema se encuentra en NP.

## Demostracion II: Reduccion de un problema NP-Completo

Debemos demostrar que Camino Hamiltoniano $\leq_P$ Fila del Primario.

### Reduccion planteada

¿Podemos resolver el problema de Camino Hamiltoniano utilizando la solucion del problema de Fila del Primario?.

Vamos a utilizar una caja negra que resuelve el problema de Fila del Primario para resolver el problema de Camino Hamiltoniano.

El problema de Camino Hamiltoniano recibe un grafo G.

Transformacion del problema: Transformamos la entrada del problema de Camino Hamiltoniano en una entrada del problema de Fila del Primario
- Transformamos los vertices $V_i$ del grafo G en alumnos $A_i$.
- Creamos el grafo complemento $G'$ de $G$.
- Para cada arista ($V_i$, $V_j$) del grafo complemento $G'$ agregamos al alumno $A_j$ al diccionario de amigos $A_i$. Es decir, las aristas que unen a los vertices en el grafo G representan qué alumnos son amigos de cuál.

Esta transformacion requiere una cantidad de pasos polinomiales.

A continuacion, para demostrar que la reduccion es correcta, debemos demostrar que:

Hay solucion de Camino Hamiltoniano, si y solo si, hay solucion para el problema de Fila del Primario.

Para demostrar ambas implicaciones tenemos dos opciones:
- Metodo directo, asumiendo para cada una que la hipotesis es cierta.
- Metodo por absurdo.

### Si hay Camino Hamiltoniano, entonces hay Fila del Primario

Hipotesis: Hay un camino que recorre todos los vertices una unica vez en el grafo $G$
Tesis: Existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos

Dada nuestra hipotesis y teniendo en cuenta que los vertices representan alumnos, en el grafo complemento $G'$ tendremos que cada arista representa que alumnos son amigos de cuàl.

Es decir, si en el grafo G tenemos que los alumnos $A_i$ y $A_j$ estan unidos, entonces en el grafo $G'$ no lo estaran con lo cual no seràn amigos.

Teniendo en cuenta que en G existe un orden de los vertices dado por el Camino Hamiltoniano, entonces en $G'$ este orden no existira con lo cual serà posible
ordenar a los alumnos en una fila de tal forma que no haya ningùn par de amigos consecutivos.

Luego, si existe un Camino Hamiltoniano en $G$ que recorre todos los vertices una unica vez, entonces existe una forma de poner en fila a los alumnos para que no haya ningùn par de amigos consecutivos.

### Si hay Fila del Primario, entonces hay Camino Hamiltoniano

Hipotesis: Existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos
Tesis: Hay un camino que recorre todos los vertices una unica vez en el grafo $G$

Dada nuestra hipotesis, si consideramos un grafo $G'$ donde los vertices son los alumnos y las aristas que unen a los vertices en el grafo G representan qué alumnos son amigos de cuál entonces en el grafo complmento $G$ tendremos aristas que unen a los vertices que representan que alumnos NO son amigos de cuàl.

Es decir, en el grafo $G$ tendremos a los alumnos ordenados segùn la fila de tal forma que no haya ningùn par de amigos consecutivos. Es decir, en el grafo $G$ tendremos un Camino Hamiltoniano que visita a los vertices una unica vez.

Luego, si existe una forma de poner en fila a los alumnos para que no haya ningún par de amigos consecutivos, entonce existe un Camino Hamiltoniano.

# Conclusion

Habiendo demostrado que la reduccion es correcta, queda demostrado tambien que el problema de Fila del Primario es un problema NP-Completo.